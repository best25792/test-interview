spring.application.name=payment-service

# Database Configuration
spring.datasource.url=jdbc:postgresql://localhost:5432/payment_db
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.username=sa
spring.datasource.password=

# HikariCP Connection Pool Configuration
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# Transaction timeout (30 seconds)
spring.transaction.default-timeout=30

# JPA Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=true

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true

# OpenTelemetry Configuration
# Disabled - using OpenTelemetry Java Agent instead (configured via OTEL_* env vars)
#management.observations.annotations.enabled=true
#management.otlp.metrics.export.url=http://localhost:4318/v1/metrics
#management.otlp.metrics.export.step=10s
#management.opentelemetry.tracing.export.otlp.endpoint=http://localhost:4318/v1/traces
#management.opentelemetry.logging.export.otlp.endpoint=http://localhost:4318/v1/logs
#management.tracing.sampling.probability=1

# Java Agent specific settings
otel.jmx.target.system=kafka-broker
otel.instrumentation.spring-scheduling.enabled=false

# Server Configuration
server.port=8083

# Inter-Service Communication URLs
qr.code.service.url=http://localhost:8084
wallet.service.url=http://localhost:8082
user.service.url=http://localhost:8081

# Kafka Configuration
spring.kafka.bootstrap-servers=localhost:9092
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.enable-idempotence=true
spring.kafka.consumer.group-id=payment-service-group
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.enable-auto-commit=false

# Resilience4j Circuit Breaker Configuration (shared defaults)
resilience4j.circuitbreaker.configs.default.failure-rate-threshold=50
resilience4j.circuitbreaker.configs.default.sliding-window-size=10
resilience4j.circuitbreaker.configs.default.minimum-number-of-calls=5
resilience4j.circuitbreaker.configs.default.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.configs.default.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.configs.default.automatic-transition-from-open-to-half-open-enabled=true

# Per-service circuit breaker instances (inherit default, add ignore-exceptions)
resilience4j.circuitbreaker.instances.walletService.base-config=default
resilience4j.circuitbreaker.instances.walletService.ignore-exceptions[0]=com.example.paymentservice.client.WalletClientService$InsufficientBalanceException
resilience4j.circuitbreaker.instances.qrCodeService.base-config=default
resilience4j.circuitbreaker.instances.qrCodeService.ignore-exceptions[0]=com.example.paymentservice.exception.QRCodeNotFoundException
resilience4j.circuitbreaker.instances.userService.base-config=default

# Resilience4j Retry Configuration (shared defaults)
resilience4j.retry.configs.default.max-attempts=3
resilience4j.retry.configs.default.wait-duration=500ms
resilience4j.retry.configs.default.retry-exceptions[0]=java.lang.Exception
resilience4j.retry.configs.default.ignore-exceptions[0]=io.github.resilience4j.circuitbreaker.CallNotPermittedException

# Per-service retry instances (inherit default, add service-specific ignores)
resilience4j.retry.instances.walletService.base-config=default
resilience4j.retry.instances.walletService.ignore-exceptions[0]=io.github.resilience4j.circuitbreaker.CallNotPermittedException
resilience4j.retry.instances.walletService.ignore-exceptions[1]=com.example.paymentservice.client.WalletClientService$InsufficientBalanceException
resilience4j.retry.instances.qrCodeService.base-config=default
resilience4j.retry.instances.qrCodeService.ignore-exceptions[0]=io.github.resilience4j.circuitbreaker.CallNotPermittedException
resilience4j.retry.instances.qrCodeService.ignore-exceptions[1]=com.example.paymentservice.exception.QRCodeNotFoundException
resilience4j.retry.instances.userService.base-config=default
resilience4j.retry.instances.userService.ignore-exceptions[0]=io.github.resilience4j.circuitbreaker.CallNotPermittedException